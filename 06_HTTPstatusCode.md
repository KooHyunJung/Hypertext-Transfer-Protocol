## 06 HTTP 상태 코드 ##
- [01 상태코드](#1)
- [02 상태 코드 상세](#2)
    - [1xx (Informational)](#2-1)
    - [2xx (Successful)](#2-2)
    - [3xx (Redirection)](#2-3)
    - [4xx (Client Error)](#2-4)
    - [5xx (Server Error)](#2-5)

---

<a name="1"></a>
## 01 상태 코드 ##

> 클라이언트가 요청을 보내면, 그 요청이 잘 처리가 됐는지/ 문제가 있는지를 응답해서 알려주는 기능

<details>
  <summary>
    <h3> 상태 코드 </h3>
  </summary>

- ``` 1xx (Informational) ```: 요청이 수신되어 처리 중(거이 사용되지 않음)
- ``` 2xx (Successful) ``` : 요청 정상 처리
- ``` 3xx (Redirection) ```: 요청을 완료하려면 추가 행동이 필요
- ``` 4xx (Client Error) ```: 클라이언트 오류, 잘못된 문법등으로 서버가 요청을 수행할 수 없음
- ``` 5xx (Server Error) ```: 서버 오류, 서버가 정상 요청을 처리하지 못함

</details>

> 만약 모르는 상태 코드가 나타나면?
- 클라이언트가 인식할 수 없는 상태코드를 서버가 반환하면?
    - 클라이언트는 ```상위 상태코드로 해석```해서 처리
    - 미래에 새로운 상태 코드가 추가되어도 클라이언트를 변경하지 않아도 됨

<a name="2"></a>
## 02 상태 코드 상세 ##

<a name="2-1"></a>
<details>
  <summary>
    <h3> 1xx (Informational) </h3>
  </summary>

- 요청이 서버에 수신되어 처리 중
- 이는 잘 사용되지 않는다

</details>

<a name="2-2"></a>
<details>
  <summary>
    <h3> 2xx (Successful) </h3>
  </summary>

- 성공
- 클라이언트에서 보낸 무언가가 잘 해결이 되었구나

```
- 200 OK
- 201 Creted
- 202 Accepted
- 204 No Content
```

- ```201 Creted```
    - 생성된 리소스는 응답의 Location 헤더 필드로 식별
    - ```Location: members/100```
- ```202 Accepted```
    - 요청이 접수되었으나 처리가 완료되지 않았음
    - 예) 요청 접수 후 서버에서는 1시간 있다가 배치를 하는 경우
- ```204 No Content```
    - 서버가 요청을 성공적으로 수행했지만, 응답 페이로드 본문에 보낼 데이터가 없음
    - 예) 웹 문서 편집기에서 save 버튼
    - save 버튼의 결과로 아무 내용이 없어도 된다
    - 결과 내용이 없어도 204 메시지(2xx)만으로 성공을 인식할 수 있다

</details>

<a name="2-3"></a>
<details>
  <summary>
    <h3> 3xx (Redirection) </h3>
  </summary>

> 요청을 완료하기 위해 유저 에이전트의 추가 조치 필요

```
- 300 Multiple Choices
- 301 Moved Permanently
- 302 Found
- 303 See Other
- 304 Not Modifiled
- 307 Temporary Redirect
- 308 Permanent Redirect
```

>
**"리다이렉션"은 무엇인가?**
- 웹 브라우저에는 3xx 응답의 결과에 Location 헤더가 있으면, 
- Location 위치로 자동 이동(리다이렉트)

<리다이렉션 종류>
- **영구 리다이렉션**
    - 특정 리소스의 URI가 영구적으로 이동
    - /members -> /users
    - /event  -> /new-event
- **일시 리다이렉션**
    - 일시적인 변경
    - 주문 완료 후 주문 내역 화면으로 이동
    - PGR: Post/Redirect/Get
- **특수 리다이렉션**
    - 결과 대신 캐시를 사용
>

- ```영구 리다이렉션```
    - 301, 308
    - 리소스 URL를 사용하지 않는다. 검색엔진 등에서도 변경 인지
    - **301 Moved Permanently**
        - 리다이렉트시 요청 메서드가 GET으로 변하고, 분문이 제거 될 수 있음(MAY)
    - **308 Permanent Redirect**
        - 301과 기능은 같음
        - 리다이렉트시 요청 메서드와 본문 유지(처음 POST를 보내면 리다이렉트)
- ```일시 리다이렉션``` 
    - 302, 307, 303
    - 리소스 URI가 일시적으로 변경
    - 영구적인 리다이렉션과 다르게 리다이렉션 됐다고 바꾸면 안된다. 
    - 다음에 어떻게 될지 모르기에 들어오는데로 받아야 한다.
    - 따라서 검색 엔진 등에서 URL을 변경하면 안된다.(실무에서 많이 사용)
    - **302 Found**
        - 리다이렉트시 요청 메서드가 GET으로 변하고, 분문이 제거 될 수 있음(MAY)
            - 영구 리다이렉션과 상황이 똑같다.
            - 처음에 스팩을 만들 때, 디테일하게 스팩이 안 적혀있다보니 브라우저에서 POST로 보내면 전부 GET으로 바꿔서 다시 리다이렉트를 하게 만들어서 307과 303이 나온 것이다.
    - **307 Temporary Redirect**
        - 302와 기능은 같음
        - 리다이렉트시 요청 [메서드]와 [본문] 유지(메서드를 변경하면 안된다. MUST NOT)
            - 예) POST는 POST, GET은 GET
    - **303 See Other**
        - 302와 기능은 같음
        - 리다이렉트시 요청 메서드가 GET으로 변경(명확하게 GET으로 변경)
> 302, 307, 303 모두 [GET으로 변경]한다. 하지만 실무에서 대부분 "302"를 사용한다.
- ```특수 리다이렉션``` 


```
<일시적인 리다이렉션 - 예시> 
    PGR: Post/Redirect/Get 
        - POST로 주문 후에 웹 브라우저를 새로고침하면?
            - 새로고침은 [다시 요청]! "중복 주문" 될 수 있다!
        - [해결방법]
            - PRG 사용 전 : 
            클라이언트에서 "URL: /order" POST 요청을 보내면
            서버에서 해당 DB에서 주문데이터를 저장하고 처리
            서버에서 응답을 내려준다 "HTTP/1.1 200 OK"
            ‼️ 이 때 "새로고침"하면 위의 패턴이 그대로 돌면서 중복 주문!
            - PRG 사용 :
            * 이 문제는 서버에서 막아주는 방법도 있지만 클라이언트에서도 방지할 수 있다(클라이언트에서 방지하는 것이 사용자 경험으로는 더 좋다)
            1) POST로 주문 후에 주문 결과 화면을 GET 메서드로 리다이렉트
            2) 새로고침 해도 결과 화면을 GET으로 조회
            3) 중복 주문 대신에 결과 화면만 GET으로 다시 요청
```
> 이미 URL이 POST > GET으로 리다이렉트 됨. 결과 화면이 GET이니까 새로고침 해도 GET이 나오는 것이다. 결론적으로 결과화면만 보여주는 것이다.

![스크린샷 2022-05-31 오후 1 54 49](https://user-images.githubusercontent.com/96563289/171095690-c4de8f32-6cbf-4690-a075-7cc142f88bea.png)

</details>

<a name="2-4"></a>
<details>
  <summary>
    <h3> 4xx (Client Error) </h3>
  </summary>

- 클라이언트 오류
- 클라이언트 요청에 잘못된 문법 등으로 서버가 요청을 수행할 수 없음
- ‼️ 클라이언트가 이미 잘못된 요청, 데이터를 보내고 있기 때문에 똑같은 재시도는 실패함

- **400 Bad Request**
- **클라이언트가 잘못된 요청을 해서 서버가 요청을 처리할 수 없음**
    - 요청 구문, 메시지 등 오류
    - 클라이언트는 요청 내용을 다시 검토하고 보내야 한다
    - 예) 요청 파라미터가 잘못되거나, API 스펙이 맞지 않을 때
- **401 Unauthorized**
- **클라이언트가 해당 리소스에 대한 인증이 필요함**
    - 인증(Authentication) 되지 않음
    - 401 오류 발생시 응답에 WWW-Authenticate 헤더와 함께 인증 방법을 설명
    - 예) 로그인 안 됨.
- **403 Forbidden**
- **서버가 요청을 이해했지만 승인을 거부함**
    - 주로 인증 자격 증명은 있지만, 접근 권한이 불충분한 경우
    - 예) 일반 회원이 로그인은 했지만, 추가 권한이 필요한 admin 페이지에 접근하려 했을 때
- **404 Not Found** 
- **요청 리소스를 찾을 수 없음**
    - 요청 리소스가 서버에 없음
    - 또는 클라이언트가 권한이 부족한 리소스에 접근할 때 "해당 리소스를 숨기고 싶을 때" 

</details>

<a name="2-5"></a>
<details>
  <summary>
    <h3> 5xx (Server Error) </h3>
  </summary>
- 서버 오류
- 서버에 문제가 있기 때문에 재시도 하면 성공할 수도 있음(복구가 되거나 등등)

- **500 Internal Server Error**
- **서버 문제로 오류 발생, 애매하면 500 오류**
    - 서버 내부 문제로 오류 발생
    - 애매하면 500 오류
- **503 Service Unavailable**
- **서비스 이용 불가**
    - 서버가 일시적인 과부하 또는 예정된 작업으로 잠시 요청을 처리할 수 없음
    - Retry-After 헤더 필드로 얼마 뒤에 복구 되는지 보낼 수도 있음

</details>

> 
왠만해서는 5xx대 에러를 내면 안된다. 
나이가 20대 이상만 주문 가능할 때, 18살 고객이 주문하면 5xx대 에러를 내면 안된다.
비즈니스 로직상 예외처리이기 때문에 4xx, 2xx으로 해결해야 한다.
정말 서버에 문제가 있을 때만, 서버가 터졌거나 DB가 내려갔을 경우에 5xx대 에러를 쓰는 것이다.
>

---
### 관련 내용 참조 ###
- 이미지 참고 : https://velog.io/@jtwjs/HTTP-%EC%83%81%ED%83%9C%EC%BD%94%EB%93%9C

### 학습 메모 ###
- 3xx 내용 복습하기
